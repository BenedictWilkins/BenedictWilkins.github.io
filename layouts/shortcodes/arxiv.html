<!-- layouts/shortcodes/arxiv.html -->

<div id='arxiv-card-{{ .Get "id" }}' class="card">
    <div class="card-header">Loading...</div>
    <div class="card-body">Fetching paper details from arXiv...</div>
</div>

<script>
    (function () {
        const cardId = '{{ .Get "id" }}';
        const arxivId = '{{ .Get "arxiv_id" }}';
        const apiUrl = `https://export.arxiv.org/api/query?id_list=${arxivId}`;

        fetch(apiUrl)
            .then(response => response.text())
            .then(data => {
                const parser = new DOMParser();
                const xmlDoc = parser.parseFromString(data, "text/xml");

                const title = xmlDoc.getElementsByTagName("title")[1].textContent;
                const summary = xmlDoc.getElementsByTagName("summary")[0].textContent;
                const published = xmlDoc.getElementsByTagName("published")[0].textContent;

                // Extract authors
                const authors = xmlDoc.getElementsByTagName("author");
                let authorList = "";
                for (let i = 0; i < authors.length; i++) {
                    const authorName = authors[i].getElementsByTagName("name")[0].textContent;
                    authorList += (i > 0 ? ", " : "") + authorName;
                }

                // Format the published date
                const publishedDate = new Date(published).toLocaleDateString();

                // Update the card content
                document.querySelector(`#arxiv-card-${cardId} .card-header`).textContent = title;
                document.querySelector(`#arxiv-card-${cardId} .card-body`).innerHTML = `
                    <p><strong>Authors:</strong> ${authorList}</p>
                    <p><strong>Published:</strong> ${publishedDate}</p>
                    <p>${summary}</p>
                `;
            })
            .catch(error => {
                document.querySelector(`#arxiv-card-${cardId} .card-header`).textContent = "Error";
                document.querySelector(`#arxiv-card-${cardId} .card-body`).textContent = "Could not fetch data from arXiv.";
            });
    })();
</script>